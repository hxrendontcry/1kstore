<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายละเอียดสินค้า | 1K Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;900&display=swap" rel="stylesheet">
    <style>body{font-family:'Kanit',sans-serif;}</style>
</head>
<body class="bg-slate-50 min-h-screen pb-20">

    <nav class="bg-white shadow-md p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <a href="/" class="text-3xl font-black text-blue-600 tracking-tighter">1K <span class="text-slate-800">STORE</span></a>
            <a href="/" class="text-gray-500 hover:text-blue-600">❮ กลับหน้าแรก</a>
        </div>
    </nav>

    <div class="container mx-auto mt-10 p-4 max-w-5xl">
        <div class="bg-white rounded-2xl shadow-xl overflow-hidden min-h-[500px] grid grid-cols-1 md:grid-cols-2">
            
            <div class="p-6 bg-slate-100 flex flex-col items-center justify-center">
                <div class="w-full h-80 bg-white rounded-xl shadow-inner mb-4 overflow-hidden flex items-center justify-center border border-slate-200">
                    <img id="main-img" class="max-w-full max-h-full object-contain transition-all duration-300" src="" alt="สินค้า">
                </div>
                <div id="thumb-gallery" class="flex gap-2 overflow-x-auto w-full py-2 px-1">
                    </div>
            </div>

            <div class="p-8 flex flex-col justify-between">
                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <span class="bg-blue-100 text-blue-600 text-xs font-bold px-2 py-1 rounded-full">พร้อมส่งทันที</span>
                        <span class="text-gray-400 text-xs" id="p-id">ID: Loading...</span>
                    </div>
                    
                    <h1 id="p-name" class="text-3xl font-black text-slate-800 mb-4 leading-tight">กำลังโหลดข้อมูล...</h1>
                    
                    <div class="text-4xl font-black text-blue-600 mb-6">
                        ฿<span id="p-price">0</span>
                    </div>

                    <p class="font-bold text-gray-700 mb-2">รายละเอียด:</p>
                    <div id="p-desc" class="text-gray-600 bg-slate-50 p-4 rounded-lg border border-slate-100 h-32 overflow-y-auto mb-6">
                        ...
                    </div>
                </div>

                <div>
                    <button onclick="buyNow()" class="w-full bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold py-4 rounded-xl shadow-lg shadow-blue-500/30 transition transform active:scale-95 flex items-center justify-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                        สั่งซื้อสินค้านี้
                    </button>
                    <p class="text-center text-xs text-gray-400 mt-3">ระบบจัดส่งอัตโนมัติภายใน 1 นาที</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ดึง ID จาก URL (เช่น product.html?id=123)
        const params = new URLSearchParams(window.location.search);
        const productId = params.get('id');

        async function loadData() {
            if(!productId) return alert("ไม่พบสินค้านี้");

            try {
                const res = await fetch(`/api/get_product_detail?id=${productId}`);
                const product = await res.json();

                if(product.error) return alert("สินค้าหมด หรือ ถูกลบไปแล้ว");

                // ใส่ข้อมูลลงหน้าเว็บ
                document.getElementById('p-id').innerText = `ID: #${product.id}`;
                document.getElementById('p-name').innerText = product.name;
                document.getElementById('p-price').innerText = product.price;
                document.getElementById('p-desc').innerText = product.description;

                // จัดการรูปภาพ (Gallery)
                const images = product.images && product.images.length > 0 ? product.images : ['https://via.placeholder.com/500?text=No+Image'];
                
                // รูปหลัก
                const mainImg = document.getElementById('main-img');
                mainImg.src = images[0];

                // สร้างรูปเล็กด้านล่าง
                const thumbContainer = document.getElementById('thumb-gallery');
                thumbContainer.innerHTML = '';
                
                images.forEach((img, index) => {
                    thumbContainer.innerHTML += `
                        <img src="${img}" onclick="changeImage('${img}')" 
                        class="w-20 h-20 object-cover rounded-lg border-2 border-transparent hover:border-blue-500 cursor-pointer transition shadow-sm bg-white">
                    `;
                });

            } catch(err) {
                console.error(err);
            }
        }

        // ฟังก์ชันเปลี่ยนรูปหลัก เมื่อกดรูปเล็ก
        function changeImage(src) {
            document.getElementById('main-img').src = src;
        }

        // ฟังก์ชันปุ่มซื้อ (เดี๋ยวทำหน้าถัดไป)
        function buyNow() {
            const user = localStorage.getItem('username');
            if(!user) {
                alert('กรุณาเข้าสู่ระบบก่อนนะครับ');
                window.location.href = '/login.html';
            } else {
                if(confirm('ยืนยันที่จะซื้อสินค้านี้?')) {
                    // เรียก API ซื้อของ (Step ต่อไป)
                    alert('ส่งคำสั่งซื้อแล้ว... (เดี๋ยวมาทำระบบตัดเงิน)');
                }
            }
        }

        loadData();
    </script>
</body>
</html>