<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ | 1K Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Kanit', 'sans-serif'] },
                    colors: {
                        luxury: { dark: '#0f172a', card: '#1e293b', gold: '#fbbf24' }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="fixed w-full z-50 top-0 bg-slate-900/80 backdrop-blur-xl border-b border-white/10">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/" class="text-2xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-blue-600 hover:opacity-80 transition">
                ‚ùÆ ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô
            </a>
            <div id="user-points" class="hidden md:flex items-center gap-2 px-4 py-1 rounded-full bg-white/5 border border-white/10">
                <span class="text-luxury-gold">ü™ô</span>
                <span id="display-points" class="font-bold text-luxury-gold">...</span>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 pt-28 pb-10 flex-grow">
        <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-10">
            
            <div class="space-y-4">
                <div class="relative group w-full h-[400px] rounded-3xl overflow-hidden border border-white/10 shadow-2xl bg-slate-800">
                    <img id="main-img" src="" class="w-full h-full object-contain transition-transform duration-700 group-hover:scale-105">
                    <div class="absolute top-4 right-4">
                        <span class="px-4 py-1 bg-green-500/20 text-green-400 border border-green-500/30 rounded-full text-sm font-bold backdrop-blur-md">
                            ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡πà‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        </span>
                    </div>
                </div>
                
                <div id="thumb-gallery" class="flex gap-3 overflow-x-auto pb-2 scrollbar-hide">
                    </div>
            </div>

            <div class="glass-panel p-8 rounded-3xl relative overflow-hidden">
                <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2 pointer-events-none"></div>

                <div class="relative z-10">
                    <div class="text-slate-400 text-sm font-mono mb-2 tracking-widest uppercase">Product ID: <span id="p-id">...</span></div>
                    
                    <h1 id="p-name" class="text-3xl md:text-4xl font-black text-white mb-6 leading-tight">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</h1>
                    
                    <div class="flex items-end gap-2 mb-8 pb-8 border-b border-white/10">
                        <span class="text-lg text-slate-400 mb-1">‡∏£‡∏≤‡∏Ñ‡∏≤</span>
                        <span class="text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-luxury-gold to-yellow-200">
                            ‡∏ø<span id="p-price">0</span>
                        </span>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-white font-bold mb-3 flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" /></svg>
                            ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </h3>
                        <div id="p-desc" class="text-slate-300 bg-slate-950/30 p-4 rounded-xl border border-white/5 h-40 overflow-y-auto leading-relaxed font-light">
                            ...
                        </div>
                    </div>

                    <button onclick="buyNow()" class="w-full group relative overflow-hidden bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-2xl shadow-[0_0_20px_rgba(37,99,235,0.3)] transition-all transform active:scale-95">
                        <div class="absolute inset-0 w-full h-full bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:animate-[shimmer_1.5s_infinite]"></div>
                        <span class="relative flex items-center justify-center gap-2 text-xl">
                            üõí ‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        </span>
                    </button>
                    <p class="text-center text-xs text-slate-500 mt-4">
                        üõ°Ô∏è ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ ‚Ä¢ ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                    </p>
                </div>
            </div>
        </div>
    </main>

    <script>
        const params = new URLSearchParams(window.location.search);
        const productId = params.get('id');
        let currentProduct = null;

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏≠‡∏¢‡∏ó‡πå‡∏°‡∏∏‡∏°‡∏ö‡∏ô
        const myPoints = localStorage.getItem('points') || 0;
        document.getElementById('display-points').innerText = parseFloat(myPoints).toLocaleString();

        async function loadData() {
            if(!productId) return window.location.href = '/';

            try {
                const res = await fetch(`/api/get_product_detail?id=${productId}`);
                const product = await res.json();

                if(product.error) {
                    await Swal.fire('‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢', '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏°‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', 'error');
                    return window.location.href = '/';
                }

                currentProduct = product;
                
                // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                document.getElementById('p-id').innerText = product.id;
                document.getElementById('p-name').innerText = product.name;
                document.getElementById('p-price').innerText = parseFloat(product.price).toLocaleString();
                document.getElementById('p-desc').innerText = product.description || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°";

                // ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                const images = product.images && product.images.length > 0 ? product.images : ['https://via.placeholder.com/500/1e293b/FFFFFF?text=No+Image'];
                document.getElementById('main-img').src = images[0];

                const thumbContainer = document.getElementById('thumb-gallery');
                images.forEach(img => {
                    thumbContainer.innerHTML += `
                        <img src="${img}" onclick="document.getElementById('main-img').src='${img}'" 
                        class="w-20 h-20 object-cover rounded-xl border-2 border-transparent hover:border-blue-500 cursor-pointer transition bg-slate-800">
                    `;
                });

            } catch(err) { console.error(err); }
        }

        async function buyNow() {
            // 1. ‡πÄ‡∏ä‡πá‡∏Ñ Login
            const userId = localStorage.getItem('user_id');
            if(!userId) {
                return Swal.fire({
                    icon: 'warning',
                    title: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
                    text: '‡∏ï‡πâ‡∏≠‡∏á‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö',
                    confirmButtonText: '‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô',
                    confirmButtonColor: '#3b82f6'
                }).then((res) => {
                    if(res.isConfirmed) window.location.href = '/login.html';
                });
            }

            // 2. ‡∏ñ‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
            const confirm = await Swal.fire({
                title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠?',
                html: `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠ <b>${currentProduct.name}</b><br>‡πÉ‡∏ô‡∏£‡∏≤‡∏Ñ‡∏≤ <b style="color:#fbbf24">${currentProduct.price} ‡∏ö‡∏≤‡∏ó</b> ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°?`,
                icon: 'question',
                background: '#1e293b', color: '#fff',
                showCancelButton: true,
                confirmButtonText: '‡πÉ‡∏ä‡πà, ‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢!',
                cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
                confirmButtonColor: '#3b82f6',
                cancelButtonColor: '#ef4444'
            });

            if(!confirm.isConfirmed) return;

            // 3. ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
            try {
                Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...', didOpen: () => Swal.showLoading(), background: '#1e293b', color: '#fff' });

                const res = await fetch('/api/buy_product', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ userId: userId, productId: productId })
                });
                const data = await res.json();

                if(data.success) {
                    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏û‡∏≠‡∏¢‡∏ó‡πå‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
                    localStorage.setItem('points', data.newPoints);
                    
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• (User/Pass)
                    await Swal.fire({
                        icon: 'success',
                        title: '‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! üéâ',
                        html: `
                            <div class="bg-slate-800 p-4 rounded-lg mt-2 border border-slate-700">
                                <p class="text-gray-400 text-sm mb-1">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:</p>
                                <code class="text-green-400 text-lg font-mono select-all block break-all">${data.stock}</code>
                                <p class="text-xs text-gray-500 mt-2">(‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏ß‡πâ‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö)</p>
                            </div>
                        `,
                        background: '#1e293b', color: '#fff',
                        confirmButtonText: '‡∏ï‡∏Å‡∏•‡∏á',
                        confirmButtonColor: '#10b981'
                    });
                    
                    window.location.href = '/'; // ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å
                } else {
                    Swal.fire({ icon: 'error', title: '‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', text: data.msg, background: '#1e293b', color: '#fff' });
                }

            } catch(err) {
                Swal.fire({ icon: 'error', title: 'Error', text: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠', background: '#1e293b', color: '#fff' });
            }
        }

        loadData();
    </script>
</body>
</html>