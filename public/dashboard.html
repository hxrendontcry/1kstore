<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô | 1K Store</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;900&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Kanit', 'sans-serif'] },
                    colors: { luxury: { dark: '#0f172a', gold: '#fbbf24' } }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #e2e8f0; }
        .glass-card { background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="fixed w-full z-50 top-0 bg-slate-900/90 backdrop-blur-xl border-b border-white/10">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="/" class="text-xl font-bold text-slate-300 hover:text-white transition flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
                ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô
            </a>
            <div class="font-bold text-luxury-gold">MEMBER DASHBOARD</div>
        </div>
    </nav>

    <main class="container mx-auto px-4 pt-24 pb-10 max-w-4xl">
        
        <div class="glass-card rounded-3xl p-8 mb-8 flex flex-col md:flex-row items-center justify-between gap-6 shadow-2xl relative overflow-hidden">
            <div class="absolute top-0 right-0 w-64 h-64 bg-blue-600/20 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>
            
            <div class="flex items-center gap-4 relative z-10">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-3xl shadow-lg border-4 border-slate-800">
                    üë§
                </div>
                <div>
                    <h1 id="u-name" class="text-3xl font-black text-white">Loading...</h1>
                    <p class="text-slate-400 text-sm tracking-wider uppercase">VIP Member</p>
                </div>
            </div>

            <div class="text-center md:text-right relative z-10 bg-slate-900/50 p-4 rounded-2xl border border-white/5">
                <p class="text-slate-400 text-xs uppercase mb-1">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</p>
                <div class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-luxury-gold to-yellow-200">
                    ‡∏ø<span id="u-points">0</span>
                </div>
            </div>
        </div>

        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
            <span class="text-blue-500">üìú</span> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
        </h2>

        <div class="glass-card rounded-2xl overflow-hidden min-h-[400px]">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-900/50 text-slate-400 uppercase text-xs tracking-wider border-b border-white/10">
                        <tr>
                            <th class="p-4 font-medium">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà / ‡πÄ‡∏ß‡∏•‡∏≤</th>
                            <th class="p-4 font-medium">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</th>
                            <th class="p-4 font-medium text-right">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</th>
                            <th class="p-4 font-medium text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        </tr>
                    </thead>
                    <tbody id="history-list" class="divide-y divide-white/5 text-sm">
                        <tr><td colspan="4" class="p-8 text-center text-slate-500">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

    </main>

    <script>
        // ‡πÄ‡∏ä‡πá‡∏Ñ Login ‡∏Å‡πà‡∏≠‡∏ô
        const userId = localStorage.getItem('user_id');
        const username = localStorage.getItem('username');
        const points = localStorage.getItem('points');

        if(!userId) window.location.href = '/login.html';

        // ‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô
        document.getElementById('u-name').innerText = username;
        document.getElementById('u-points').innerText = parseFloat(points).toLocaleString();

        async function loadHistory() {
            try {
                const res = await fetch(`/api/get_history?userId=${userId}`);
                const data = await res.json();
                
                const tbody = document.getElementById('history-list');
                tbody.innerHTML = '';

                if(data.history.length === 0) {
                    tbody.innerHTML = `<tr><td colspan="4" class="p-10 text-center text-slate-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ñ‡∏£‡∏±‡∏ö</td></tr>`;
                    return;
                }

                data.history.forEach(item => {
                    const date = new Date(item.created_at).toLocaleString('th-TH');
                    
                    // ‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á vs ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô)
                    let title, amountClass, icon, statusHtml;
                    
                    if(item.type === 'buy_product') {
                        // ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á
                        title = `<span class="text-white font-bold">${item.detail}</span>`;
                        amountClass = "text-red-400"; // ‡∏™‡∏µ‡πÅ‡∏î‡∏á (‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏≠‡∏Å)
                        icon = "-";
                        statusHtml = `<span class="px-2 py-1 rounded bg-green-500/10 text-green-400 border border-green-500/20 text-xs">‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</span>`;
                    } else {
                        // ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô
                        title = `‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô (${item.detail || 'TrueMoney'})`;
                        amountClass = "text-green-400"; // ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß (‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤)
                        icon = "+";
                        statusHtml = `<span class="px-2 py-1 rounded bg-blue-500/10 text-blue-400 border border-blue-500/20 text-xs">‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô</span>`;
                    }

                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° "‡∏î‡∏π‡∏Ç‡∏≠‡∏á" ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡∏∑‡πâ‡∏≠
                    let viewBtn = "";
                    /* ‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡πà‡∏ô‡∏à‡∏£‡∏¥‡∏á‡∏ï‡πâ‡∏≠‡∏á Join table ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤ User/Pass ‡∏°‡∏≤‡πÇ‡∏ä‡∏ß‡πå
                       ‡πÅ‡∏ï‡πà‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡πÇ‡∏ä‡∏ß‡πå‡πÅ‡∏Ñ‡πà Log ‡πÑ‡∏õ‡∏Å‡πà‡∏≠‡∏ô */

                    tbody.innerHTML += `
                        <tr class="hover:bg-white/5 transition">
                            <td class="p-4 text-slate-400">${date}</td>
                            <td class="p-4">${title}</td>
                            <td class="p-4 text-right font-bold ${amountClass}">${icon}‡∏ø${item.amount}</td>
                            <td class="p-4 text-center">${statusHtml}</td>
                        </tr>
                    `;
                });

            } catch(err) {
                console.error(err);
            }
        }

        loadHistory();
    </script>
</body>
</html>